
# I want to grow a variable according to the weight of each country and the global changes (Creating a Bartik Instrument in R)

I am conducting some regression analysis and I need to first create a Bartik Instrument to use as an IV. Essentially, I have 10 decile groups of the income distribution. These are both at a global level and a country level (as there is an unbalanced panel of countries in the dataset). I want to grow each country's decile groups according to worldwide changes.

The image above represents the world and shows the percentage of people in each income decile on the left-hand side. On the right are the calculated percentage changes for each income decile between years. There are 10 columns all up for the 10 deciles.
The image below shows the country's decile groups. The starting year will be 1990 for each country (ie, the beginning decile proportion for each decile will be the year 1990 for each country. This serves as the "weight" in all of the statistics). Then, each decile will grow at the same percentage change as the global level.

For example, if dp1 is 1.92 in 1990 for the country Afghanistan, 1991 will be calculated from the global percentage change between 1990 and 1991. Because the global change was -2.857%, the predicted value of dp1 in 1991 for Afghanistan will be 1.865. This value will then be used in the calculation for predicting 1992.
The issue is, it needs to start at 1990 for each country and end in the final predicted year of 2019. I cannot just use a mutate function as it won't recognize that each country restarts in 1990.
Any guidance on this issue will be greatly appreciated. Please let me know if you need to see any more of the data as it is all open source and can therefore be freely shared.
Dput of the world data frame:
structure(list(Entity = c("World", "World", "World", "World", 
"World", "World", "World", "World", "World", "World", "World", 
"World", "World", "World", "World", "World", "World", "World", 
"World", "World", "World", "World", "World", "World", "World", 
"World", "World", "World", "World", "World", "World"), Year = c(1990, 
1991, 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 
2002, 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010, 2011, 2012, 
2013, 2014, 2015, 2016, 2017, 2018, 2019, 2020), Code = c("WLD", 
"WLD", "WLD", "WLD", "WLD", "WLD", "WLD", "WLD", "WLD", "WLD", 
"WLD", "WLD", "WLD", "WLD", "WLD", "WLD", "WLD", "WLD", "WLD", 
"WLD", "WLD", "WLD", "WLD", "WLD", "WLD", "WLD", "WLD", "WLD", 
"WLD", "WLD", "WLD"), gini = c("69.95", "70.18", "70.07", "69.88", 
"69.79", "69.51", "69.16", "68.93", "68.98", "68.83", "68.76", 
"68.43", "68.1", "67.68", "67.24", "66.79", "66.22", "65.57", 
"64.9", "63.8", "63.28", "62.92", "62.54", "62.11", "61.68", 
"61.47", "61.12", "60.92", "60.81", "60.65", "60.6"), palma = c(14.44, 
14.74, 14.2, 13.7, 13.28, 12.95, 12.46, 12.31, 12.12, 12.04, 
12.12, 11.74, 11.49, 11.18, 10.91, 10.55, 10.08, 9.67, 9.27, 
8.53, 8.29, 8.12, 7.91, 7.74, 7.47, 7.36, 7.25, 7.11, 7.07, 6.95, 
6.97), dp1 = c(0.35, 0.34, 0.35, 0.36, 0.36, 0.38, 0.38, 0.38, 
0.39, 0.38, 0.38, 0.39, 0.38, 0.38, 0.39, 0.39, 0.4, 0.4, 0.4, 
0.43, 0.43, 0.43, 0.43, 0.43, 0.45, 0.45, 0.44, 0.43, 0.44, 0.44, 
0.43), dp2 = c(0.71, 0.72, 0.76, 0.78, 0.82, 0.82, 0.84, 0.86, 
0.87, 0.9, 0.88, 0.89, 0.9, 0.92, 0.93, 0.93, 0.95, 0.98, 1.01, 
1.07, 1.09, 1.1, 1.1, 1.14, 1.14, 1.14, 1.17, 1.19, 1.18, 1.19, 
1.2), dp3 = c(1.09, 1.06, 1.1, 1.18, 1.19, 1.25, 1.29, 1.31, 
1.3, 1.33, 1.31, 1.36, 1.38, 1.39, 1.43, 1.48, 1.5, 1.54, 1.59, 
1.69, 1.72, 1.74, 1.79, 1.81, 1.83, 1.88, 1.89, 1.88, 1.94, 1.95, 
1.94), dp4 = c(1.52, 1.5, 1.59, 1.64, 1.74, 1.75, 1.82, 1.82, 
1.9, 1.89, 1.88, 1.93, 1.97, 2, 2.02, 2.07, 2.18, 2.24, 2.29, 
2.44, 2.48, 2.51, 2.57, 2.58, 2.71, 2.72, 2.73, 2.82, 2.76, 2.81, 
2.8), dp5 = c(2.11, 2.15, 2.27, 2.34, 2.42, 2.51, 2.53, 2.56, 
2.6, 2.64, 2.7, 2.72, 2.74, 2.8, 2.92, 2.99, 3.05, 3.1, 3.2, 
3.44, 3.52, 3.57, 3.65, 3.77, 3.76, 3.86, 3.93, 3.96, 3.95, 4.03, 
4.04), dp6 = c(3.23, 3.18, 3.25, 3.38, 3.44, 3.52, 3.6, 3.64, 
3.66, 3.74, 3.68, 3.87, 3.98, 4.08, 4.07, 4.14, 4.35, 4.54, 4.68, 
4.85, 5.02, 5.11, 5.2, 5.29, 5.48, 5.43, 5.54, 5.56, 5.62, 5.6, 
5.57), dp7 = c(5.49, 5.42, 5.43, 5.42, 5.37, 5.41, 5.5, 5.66, 
5.49, 5.57, 5.67, 5.73, 5.86, 6.03, 6.23, 6.23, 6.49, 6.63, 6.91, 
7.12, 7.37, 7.38, 7.59, 7.72, 7.84, 7.94, 7.92, 8.02, 8, 8.05, 
8.13), dp8 = c(10.96, 10.76, 10.3, 10.04, 9.78, 9.73, 9.78, 9.82, 
9.67, 9.61, 9.7, 9.75, 9.73, 10, 10.18, 10.5, 10.55, 10.88, 11.04, 
11.32, 11.4, 11.63, 11.62, 11.72, 11.78, 11.82, 12.05, 11.85, 
12.1, 12.08, 12.12), dp9 = c(21.51, 21.26, 20.81, 20.53, 20.22, 
20.17, 20.15, 20.03, 19.9, 19.75, 19.77, 19.7, 19.88, 19.72, 
19.74, 19.75, 19.69, 19.71, 19.75, 19.51, 19.48, 19.49, 19.39, 
19.36, 19.23, 19.14, 19.05, 19.37, 19.25, 19.3, 19.38), dp10 = c(52.93, 
53.51, 54.05, 54.24, 54.58, 54.39, 54.02, 53.85, 54.14, 54.13, 
53.96, 53.6, 53.13, 52.61, 52.04, 51.45, 50.77, 49.93, 49.08, 
48.07, 47.44, 46.98, 46.61, 46.14, 45.75, 45.56, 45.23, 44.9, 
44.72, 44.52, 44.37), `dp1_PChangeFrom-1` = c(NA, -0.0285714285714284, 
0.0294117647058822, 0.0285714285714286, 0, 0.0555555555555556, 
0, 0, 0.0263157894736842, -0.0256410256410257, 0, 0.0263157894736842, 
-0.0256410256410257, 0, 0.0263157894736842, 0, 0.0256410256410257, 
0, 0, 0.0749999999999999, 0, 0, 0, 0, 0.0465116279069768, 0, 
-0.0222222222222222, -0.0227272727272727, 0.0232558139534884, 
0, -0.0227272727272727), `dp2_PChangeFrom-1` = c(NA, 0.0140845070422535, 
0.0555555555555556, 0.0263157894736842, 0.0512820512820512, 0, 
0.024390243902439, 0.0238095238095238, 0.0116279069767442, 0.0344827586206897, 
-0.0222222222222222, 0.0113636363636364, 0.0112359550561798, 
0.0222222222222222, 0.0108695652173913, 0, 0.0215053763440859, 
0.0315789473684211, 0.0306122448979592, 0.0594059405940595, 0.0186915887850467, 
0.00917431192660551, 0, 0.0363636363636362, 0, 0, 0.0263157894736842, 
0.0170940170940171, -0.00840336134453782, 0.00847457627118645, 
0.00840336134453782), `dp3_PChangeFrom-1` = c(NA, -0.0275229357798165, 
0.0377358490566038, 0.0727272727272726, 0.00847457627118645, 
0.0504201680672269, 0.032, 0.0155038759689923, -0.00763358778625955, 
0.0230769230769231, -0.0150375939849624, 0.0381679389312977, 
0.014705882352941, 0.00724637681159421, 0.0287769784172662, 0.034965034965035, 
0.0135135135135135, 0.0266666666666667, 0.0324675324675325, 0.0628930817610062, 
0.0177514792899408, 0.0116279069767442, 0.0287356321839081, 0.0111731843575419, 
0.0110497237569061, 0.0273224043715846, 0.00531914893617022, 
-0.0052910052910053, 0.0319148936170213, 0.00515463917525774, 
-0.00512820512820513), `dp4_PChangeFrom-1` = c(NA, -0.0131578947368421, 
0.0600000000000001, 0.031446540880503, 0.0609756097560976, 0.00574712643678161, 
0.04, 0, 0.0439560439560439, -0.00526315789473685, -0.0052910052910053, 
0.0265957446808511, 0.0207253886010363, 0.0152284263959391, 0.01, 
0.0247524752475247, 0.0531400966183576, 0.0275229357798165, 0.0223214285714285, 
0.0655021834061135, 0.0163934426229508, 0.0120967741935483, 0.0239043824701195, 
0.00389105058365768, 0.0503875968992248, 0.00369003690036909, 
0.00367647058823522, 0.0329670329670329, -0.0212765957446809, 
0.0181159420289856, -0.00355871886121005), `dp5_PChangeFrom-1` = c(NA, 
0.018957345971564, 0.0558139534883721, 0.0308370044052863, 0.0341880341880342, 
0.037190082644628, 0.00796812749003985, 0.0118577075098815, 0.015625, 
0.0153846153846154, 0.0227272727272727, 0.00740740740740741, 
0.00735294117647059, 0.021897810218978, 0.0428571428571429, 0.0239726027397261, 
0.0200668896321069, 0.0163934426229509, 0.0322580645161291, 0.0749999999999999, 
0.0232558139534884, 0.0142045454545454, 0.0224089635854342, 0.0328767123287672, 
-0.00265251989389927, 0.0265957446808511, 0.0181347150259068, 
0.00763358778625949, -0.00252525252525247, 0.020253164556962, 
0.00248138957816372), `dp6_PChangeFrom-1` = c(NA, -0.0154798761609907, 
0.0220125786163522, 0.04, 0.0177514792899408, 0.0232558139534884, 
0.0227272727272727, 0.0111111111111111, 0.0054945054945055, 0.0218579234972678, 
-0.0160427807486631, 0.0516304347826087, 0.0284237726098191, 
0.0251256281407035, -0.00245098039215681, 0.017199017199017, 
0.0507246376811594, 0.0436781609195403, 0.0308370044052863, 0.0363247863247863, 
0.0350515463917526, 0.0179282868525898, 0.0176125244618395, 0.0173076923076923, 
0.0359168241965974, -0.00912408759124101, 0.0202578268876612, 
0.00361010830324902, 0.0107913669064749, -0.00355871886121005, 
-0.00535714285714274), `dp7_PChangeFrom-1` = c(NA, -0.0127504553734062, 
0.00184501845018446, -0.00184162062615097, -0.00922509225092248, 
0.00744878957169461, 0.0166358595194085, 0.0290909090909091, 
-0.0300353356890459, 0.0145719489981785, 0.0179533213644524, 
0.0105820105820107, 0.0226876090750436, 0.0290102389078498, 0.033167495854063, 
0, 0.0417335473515248, 0.0215716486902927, 0.0422322775263952, 
0.0303907380607815, 0.0351123595505618, 0.00135685210312073, 
0.0284552845528455, 0.0171277997364954, 0.0155440414507772, 0.0127551020408164, 
-0.00251889168765749, 0.0126262626262626, -0.00249376558603486, 
0.00625000000000009, 0.00993788819875777), `dp8_PChangeFrom-1` = c(NA, 
-0.0182481751824818, -0.0427509293680297, -0.0252427184466021, 
-0.0258964143426295, -0.0051124744376277, 0.00513874614594028, 
0.00408997955010234, -0.0152749490835031, -0.00620475698035165, 
0.00936524453694067, 0.00515463917525781, -0.00205128205128201, 
0.0277492291880781, 0.018, 0.031434184675835, 0.00476190476190483, 
0.0312796208530806, 0.014705882352941, 0.0253623188405798, 0.00706713780918729, 
0.0201754385964913, -0.00085984522785912, 0.00860585197934608, 
0.00511945392491457, 0.00339558573853998, 0.0194585448392555, 
-0.0165975103734441, 0.0210970464135021, -0.00165289256198344, 
0.00331125827814562), `dp9_PChangeFrom-1` = c(NA, -0.0116225011622501, 
-0.0211665098777047, -0.0134550696780393, -0.015099853872382, 
-0.00247279920870411, -0.000991571641051221, -0.00595533498759293, 
-0.00649026460309548, -0.00753768844221098, 0.00101265822784808, 
-0.0035407182599899, 0.00913705583756344, -0.00804828973843059, 
0.00101419878296144, 0.000506585612968671, -0.00303797468354424, 
0.00101574403250379, 0.00202942668696089, -0.0121518987341771, 
-0.00153767298821123, 0.000513347022587167, -0.00513083632632108, 
-0.0015471892728211, -0.0067148760330578, -0.00468018720748829, 
-0.00470219435736676, 0.0167979002624672, -0.0061951471347445, 
0.00259740259740263, 0.00414507772020717), `dp10_PChangeFrom-1` = c(NA, 
0.0109578688834309, 0.0100915716688469, 0.00351526364477345, 
0.00626843657817102, -0.00348112861854155, -0.00680272108843533, 
-0.00314698259903743, 0.00538532961931289, -0.000184706316956003, 
-0.00314058747459822, -0.00667160859896218, -0.00876865671641789, 
-0.00978731413514028, -0.0108344421212697, -0.011337432744043, 
-0.0132167152575316, -0.0165452038605476, -0.0170238333667134, 
-0.0205786471067644, -0.0131058872477637, -0.00969645868465432, 
-0.00787569178373771, -0.0100836730315383, -0.00845253576072823, 
-0.00415300546448082, -0.00724319578577712, -0.00729604244970149, 
-0.00400890868596881, -0.00447227191413228, -0.00336927223719689
)), row.names = c(NA, -31L), class = "data.frame")

dput of the countries data frame::
structure(list(Year = numeric(0), Entity = character(0), Code = character(0), 
    gini = character(0), palma = numeric(0), dp1 = numeric(0), 
    dp2 = numeric(0), dp3 = numeric(0), dp4 = numeric(0), dp5 = numeric(0), 
    dp6 = numeric(0), dp7 = numeric(0), dp8 = numeric(0), dp9 = numeric(0), 
    dp10 = numeric(0)), class = c("grouped_df", "tbl_df", "tbl", 
"data.frame"), row.names = integer(0), groups = structure(list(
    Entity = character(0), Year = numeric(0), .rows = structure(list(), ptype = integer(0), class = c("vctrs_list_of", 
    "vctrs_vctr", "list"))), row.names = integer(0), class = c("tbl_df", 
"tbl", "data.frame"), .drop = TRUE))



        